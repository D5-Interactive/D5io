<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="D5io - Innovative Software Solutions">
    <title>D5i</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            color: white;
        }

        header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        header p {
            font-size: 1.3em;
            opacity: 0.9;
        }

        .slideshow-container {
            max-width: 900px;
            position: relative;
            margin: 40px auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .slide {
            display: none;
            padding: 40px;
            text-align: left;
            animation: fadeIn 1s;
            max-height: 600px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .slide::-webkit-scrollbar {
            width: 8px;
        }

        .slide::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .slide::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        .slide::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        .slide.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide h2 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        .slide h3 {
            color: #667eea;
            font-size: 1.8em;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .slide h4 {
            color: #764ba2;
            font-size: 1.4em;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .slide p {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 15px;
            line-height: 1.8;
        }

        .slide ul, .slide ol {
            margin-left: 20px;
            margin-bottom: 15px;
            color: #666;
        }

        .slide li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .slide ol {
            list-style-type: decimal;
        }

        .slide pre {
            background: #f5f5f5;
            border-left: 4px solid #667eea;
            padding: 15px;
            overflow-x: auto;
            margin-bottom: 15px;
            border-radius: 4px;
        }

        .slide code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
        }

        .slide pre code {
            background: none;
            padding: 0;
        }

        .slide blockquote {
            border-left: 4px solid #667eea;
            padding-left: 20px;
            margin: 20px 0;
            font-style: italic;
            color: #555;
        }

        .slide table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.95em;
        }

        .slide table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .slide table td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        .slide table tr:hover {
            background: #f9f9f9;
        }

        .slide hr {
            border: none;
            border-top: 2px solid #e0e0e0;
            margin: 30px 0;
        }

        .product-icon {
            font-size: 5em;
            margin-bottom: 20px;
            text-align: center;
        }

        .features {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
            text-align: center;
        }

        .feature-tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .dots-container {
            text-align: center;
            padding: 20px;
            background: white;
        }

        .dot {
            height: 15px;
            width: 15px;
            margin: 0 5px;
            background-color: #bbb;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
            padding: 0;
        }

        .dot.active {
            background-color: #667eea;
        }

        .dot:hover {
            background-color: #764ba2;
        }

        .prev, .next {
            cursor: pointer;
            position: absolute;
            top: 50%;
            width: auto;
            margin-top: -22px;
            padding: 16px;
            color: white;
            font-weight: bold;
            font-size: 24px;
            transition: 0.3s;
            border-radius: 0 3px 3px 0;
            user-select: none;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 10;
            border: none;
        }

        .next {
            right: 0;
            border-radius: 3px 0 0 3px;
        }

        .prev:hover, .next:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }

        footer {
            text-align: center;
            padding: 30px;
            color: white;
            margin-top: 40px;
        }

        footer a {
            color: white;
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2em;
            }

            header p {
                font-size: 1em;
            }

            .slide {
                padding: 30px 20px;
                max-height: 500px;
            }

            .slide h2 {
                font-size: 1.8em;
            }

            .slide h3 {
                font-size: 1.4em;
            }

            .slide h4 {
                font-size: 1.2em;
            }

            .slide p {
                font-size: 1em;
            }

            .product-icon {
                font-size: 3em;
            }

            .slide table {
                font-size: 0.85em;
            }

            .slide table th,
            .slide table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>D5i</h1>
            <p>DevSecOps Utilities & Applications | Made for Efficiency</p>
        </header>

        <div class="slideshow-container">
            <button class="prev" onclick="changeSlide(-1)" aria-label="Previous slide">&#10094;</button>
            <button class="next" onclick="changeSlide(1)" aria-label="Next slide">&#10095;</button>

            <div id="slides-container"></div>

            <div class="dots-container" id="dots-container"></div>
        </div>

        <footer>
            <p>&copy; 2025 D5i. All rights reserved.</p>
            <p><a href="https://github.com/D5-Interactive/D5io" target="_blank">Visit us on GitHub</a></p>
        </footer>
    </div>

    <script>
        let currentSlide = 0;
        let slideInterval;
        let slidesLoaded = false;

        // Enhanced markdown parser for comprehensive formatting
        function parseMarkdown(text) {
            let lines = text.split('\n');
            let html = '';
            let inCodeBlock = false;
            let inTable = false;
            let inList = false;
            let inOrderedList = false;
            let codeBlockContent = '';
            let tableRows = [];
            let listItems = [];
            let orderedListItems = [];
            
            for (let i = 0; i < lines.length; i++) {
                let line = lines[i];
                
                // Handle code blocks
                if (line.trim().startsWith('```')) {
                    if (!inCodeBlock) {
                        inCodeBlock = true;
                        codeBlockContent = '';
                    } else {
                        html += '<pre><code>' + escapeHtml(codeBlockContent) + '</code></pre>';
                        inCodeBlock = false;
                        codeBlockContent = '';
                    }
                    continue;
                }
                
                if (inCodeBlock) {
                    codeBlockContent += line + '\n';
                    continue;
                }
                
                // Close unordered list if needed
                if (inList && !line.trim().startsWith('-') && !line.trim().startsWith('*') && !line.trim().startsWith('+') && line.trim() !== '') {
                    html += '<ul>' + listItems.join('') + '</ul>';
                    inList = false;
                    listItems = [];
                }
                
                // Close ordered list if needed
                if (inOrderedList && !line.trim().match(/^\d+\.\s/) && line.trim() !== '') {
                    html += '<ol>' + orderedListItems.join('') + '</ol>';
                    inOrderedList = false;
                    orderedListItems = [];
                }
                
                // Handle tables
                if (line.trim().startsWith('|')) {
                    if (!inTable) {
                        inTable = true;
                        tableRows = [];
                    }
                    tableRows.push(line);
                    // Check if next line is not a table row
                    if (i + 1 >= lines.length || !lines[i + 1].trim().startsWith('|')) {
                        html += parseTable(tableRows);
                        inTable = false;
                        tableRows = [];
                    }
                    continue;
                }
                
                // Handle headings
                if (line.trim().startsWith('####')) {
                    html += '<h4>' + parseInline(line.replace(/^####\s*/, '')) + '</h4>';
                } else if (line.trim().startsWith('###')) {
                    html += '<h3>' + parseInline(line.replace(/^###\s*/, '')) + '</h3>';
                } else if (line.trim().startsWith('##')) {
                    html += '<h3>' + parseInline(line.replace(/^##\s*/, '')) + '</h3>';
                } else if (line.trim().startsWith('#')) {
                    html += '<h2>' + parseInline(line.replace(/^#\s*/, '')) + '</h2>';
                }
                // Handle horizontal rules
                else if (line.trim() === '---' || line.trim() === '***') {
                    html += '<hr>';
                }
                // Handle blockquotes
                else if (line.trim().startsWith('>')) {
                    html += '<blockquote>' + parseInline(line.replace(/^>\s*/, '')) + '</blockquote>';
                }
                // Handle unordered lists
                else if (line.trim().match(/^[-*+]\s/)) {
                    if (!inList) {
                        inList = true;
                    }
                    listItems.push('<li>' + parseInline(line.replace(/^[-*+]\s*/, '')) + '</li>');
                }
                // Handle ordered lists
                else if (line.trim().match(/^\d+\.\s/)) {
                    if (!inOrderedList) {
                        inOrderedList = true;
                    }
                    orderedListItems.push('<li>' + parseInline(line.replace(/^\d+\.\s*/, '')) + '</li>');
                }
                // Handle empty lines
                else if (line.trim() === '') {
                    if (inList) {
                        html += '<ul>' + listItems.join('') + '</ul>';
                        inList = false;
                        listItems = [];
                    }
                    if (inOrderedList) {
                        html += '<ol>' + orderedListItems.join('') + '</ol>';
                        inOrderedList = false;
                        orderedListItems = [];
                    }
                    // Skip empty lines
                }
                // Regular paragraphs
                else {
                    html += '<p>' + parseInline(line) + '</p>';
                }
            }
            
            // Close any open list
            if (inList) {
                html += '<ul>' + listItems.join('') + '</ul>';
            }
            if (inOrderedList) {
                html += '<ol>' + orderedListItems.join('') + '</ol>';
            }
            
            return html;
        }
        
        function parseInline(text) {
            // Bold: **text** or __text__
            text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            text = text.replace(/__(.+?)__/g, '<strong>$1</strong>');
            
            // Italic: *text* or _text_ (but not in URLs or already processed bold)
            // Use a simpler pattern that works in all browsers
            text = text.replace(/\b\*([^*]+?)\*\b/g, '<em>$1</em>');
            
            // Inline code: `code`
            text = text.replace(/`([^`]+?)`/g, '<code>$1</code>');
            
            // Links: [text](url)
            text = text.replace(/\[([^\]]+?)\]\(([^)]+?)\)/g, '<a href="$2" target="_blank">$1</a>');
            
            return text;
        }
        
        function parseTable(rows) {
            // Validate table structure (need at least header + separator + 1 data row)
            if (rows.length < 3) {
                console.warn('Invalid table structure: need at least 3 rows (header, separator, data)');
                return '';
            }
            
            let html = '<table>';
            
            // Parse header
            let headerCells = rows[0].split('|').filter(cell => cell.trim() !== '');
            html += '<thead><tr>';
            headerCells.forEach(cell => {
                html += '<th>' + parseInline(cell.trim()) + '</th>';
            });
            html += '</tr></thead>';
            
            // Skip separator row (row 1)
            html += '<tbody>';
            for (let i = 2; i < rows.length; i++) {
                let cells = rows[i].split('|').filter(cell => cell.trim() !== '');
                html += '<tr>';
                cells.forEach(cell => {
                    html += '<td>' + parseInline(cell.trim()) + '</td>';
                });
                html += '</tr>';
            }
            html += '</tbody></table>';
            
            return html;
        }
        
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // Parse frontmatter from markdown content
        function parseFrontmatter(content) {
            const frontmatterRegex = /^---\s*\n([\s\S]*?)\n---\s*\n([\s\S]*)$/;
            const match = content.match(frontmatterRegex);
            
            if (!match) {
                return { frontmatter: {}, body: content };
            }
            
            const frontmatterText = match[1];
            const body = match[2];
            const frontmatter = {};
            
            // Parse simple YAML-like frontmatter
            const lines = frontmatterText.split('\n');
            for (const line of lines) {
                const colonIndex = line.indexOf(':');
                if (colonIndex > -1) {
                    const key = line.substring(0, colonIndex).trim();
                    let value = line.substring(colonIndex + 1).trim();
                    
                    // Parse array values [item1, item2, item3]
                    if (value.startsWith('[') && value.endsWith(']')) {
                        value = value.substring(1, value.length - 1)
                            .split(',')
                            .map(item => item.trim());
                    }
                    
                    frontmatter[key] = value;
                }
            }
            
            return { frontmatter, body };
        }

        // Create a slide DOM element from product data
        function createSlide(product) {
            const slide = document.createElement('div');
            slide.className = 'slide';
            
            // Add product icon
            const icon = document.createElement('div');
            icon.className = 'product-icon';
            icon.textContent = product.icon || 'üì¶';
            slide.appendChild(icon);
            
            // Add title
            const title = document.createElement('h2');
            title.textContent = product.title || 'Product';
            slide.appendChild(title);
            
            // Add description (rendered markdown) - use div instead of p for block-level elements
            const description = document.createElement('div');
            description.innerHTML = parseMarkdown(product.body || '');
            slide.appendChild(description);
            
            // Add features/tags
            if (product.tags && product.tags.length > 0) {
                const features = document.createElement('div');
                features.className = 'features';
                
                product.tags.forEach(tag => {
                    const tagSpan = document.createElement('span');
                    tagSpan.className = 'feature-tag';
                    tagSpan.textContent = tag;
                    features.appendChild(tagSpan);
                });
                
                slide.appendChild(features);
            }
            
            return slide;
        }

        // Load products from manifest and markdown files
        async function loadProducts() {
            try {
                // Fetch manifest
                const manifestResponse = await fetch('/products/products.json');
                if (!manifestResponse.ok) {
                    throw new Error('Failed to load products manifest');
                }
                const manifest = await manifestResponse.json();
                
                if (!manifest || manifest.length === 0) {
                    throw new Error('No products found in manifest');
                }
                
                // Load each product markdown file
                const products = [];
                for (const filename of manifest) {
                    try {
                        const response = await fetch(`/products/${filename}`);
                        if (!response.ok) {
                            console.warn(`Failed to load product: ${filename}`);
                            continue;
                        }
                        
                        const content = await response.text();
                        const { frontmatter, body } = parseFrontmatter(content);
                        
                        products.push({
                            icon: frontmatter.icon,
                            title: frontmatter.title,
                            tags: frontmatter.tags,
                            body: body.trim()
                        });
                    } catch (error) {
                        console.warn(`Error loading product ${filename}:`, error);
                    }
                }
                
                if (products.length === 0) {
                    throw new Error('No products could be loaded');
                }
                
                // Create slide elements
                const slidesContainer = document.getElementById('slides-container');
                const dotsContainer = document.getElementById('dots-container');
                
                products.forEach((product, index) => {
                    // Create slide
                    const slide = createSlide(product);
                    if (index === 0) {
                        slide.classList.add('active');
                    }
                    slidesContainer.appendChild(slide);
                    
                    // Create dot
                    const dot = document.createElement('button');
                    dot.className = 'dot';
                    if (index === 0) {
                        dot.classList.add('active');
                        dot.setAttribute('aria-current', 'true');
                    }
                    dot.setAttribute('aria-label', `Go to slide ${index + 1}`);
                    dot.onclick = () => setSlide(index);
                    dotsContainer.appendChild(dot);
                });
                
                slidesLoaded = true;
                
                // Initialize slideshow
                showSlide();
                slideInterval = setInterval(nextSlide, 5000);
                
            } catch (error) {
                console.error('Error loading products:', error);
                
                // Show fallback slide
                const slidesContainer = document.getElementById('slides-container');
                const fallbackSlide = document.createElement('div');
                fallbackSlide.className = 'slide active';
                fallbackSlide.innerHTML = `
                    <div class="product-icon">‚ö†Ô∏è</div>
                    <h2>Products Coming Soon</h2>
                    <p>We're currently updating our product catalog. Please check back later.</p>
                `;
                slidesContainer.appendChild(fallbackSlide);
            }
        }

        function showSlide() {
            if (!slidesLoaded) return;
            
            const slides = document.getElementsByClassName('slide');
            const dots = document.getElementsByClassName('dot');
            
            if (slides.length === 0) return;

            if (currentSlide >= slides.length) {
                currentSlide = 0;
            }
            if (currentSlide < 0) {
                currentSlide = slides.length - 1;
            }

            // Hide all slides and remove aria-current
            for (let i = 0; i < slides.length; i++) {
                slides[i].classList.remove('active');
                dots[i].classList.remove('active');
                dots[i].removeAttribute('aria-current');
            }

            // Show current slide and set aria-current
            slides[currentSlide].classList.add('active');
            dots[currentSlide].classList.add('active');
            dots[currentSlide].setAttribute('aria-current', 'true');
        }

        function changeSlide(n) {
            if (!slidesLoaded) return;
            currentSlide += n;
            showSlide();
            resetInterval();
        }

        function setSlide(n) {
            if (!slidesLoaded) return;
            currentSlide = n;
            showSlide();
            resetInterval();
        }

        function nextSlide() {
            if (!slidesLoaded) return;
            currentSlide++;
            showSlide();
        }

        function resetInterval() {
            clearInterval(slideInterval);
            slideInterval = setInterval(nextSlide, 5000);
        }

        function pauseSlideshow() {
            clearInterval(slideInterval);
        }

        function resumeSlideshow() {
            if (slidesLoaded) {
                slideInterval = setInterval(nextSlide, 5000);
            }
        }

        // Load products when page loads
        window.addEventListener('DOMContentLoaded', loadProducts);

        // Pause slideshow on hover or focus for accessibility (WCAG compliance)
        const slideshowContainer = document.querySelector('.slideshow-container');
        slideshowContainer.addEventListener('mouseenter', pauseSlideshow);
        slideshowContainer.addEventListener('mouseleave', resumeSlideshow);
        slideshowContainer.addEventListener('focusin', pauseSlideshow);
        slideshowContainer.addEventListener('focusout', resumeSlideshow);
    </script>
</body>
</html>
