<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="D5io - Innovative Software Solutions">
    <title>D5io - Software Solutions</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            color: white;
        }

        header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        header p {
            font-size: 1.3em;
            opacity: 0.9;
        }

        .slideshow-container {
            max-width: 900px;
            position: relative;
            margin: 40px auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .slide {
            display: none;
            padding: 60px 40px;
            text-align: center;
            animation: fadeIn 1s;
        }

        .slide.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide h2 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .slide p {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.8;
        }

        .product-icon {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .features {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .feature-tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .dots-container {
            text-align: center;
            padding: 20px;
            background: white;
        }

        .dot {
            height: 15px;
            width: 15px;
            margin: 0 5px;
            background-color: #bbb;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
            padding: 0;
        }

        .dot.active {
            background-color: #667eea;
        }

        .dot:hover {
            background-color: #764ba2;
        }

        .prev, .next {
            cursor: pointer;
            position: absolute;
            top: 50%;
            width: auto;
            margin-top: -22px;
            padding: 16px;
            color: white;
            font-weight: bold;
            font-size: 24px;
            transition: 0.3s;
            border-radius: 0 3px 3px 0;
            user-select: none;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 10;
            border: none;
        }

        .next {
            right: 0;
            border-radius: 3px 0 0 3px;
        }

        .prev:hover, .next:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }

        footer {
            text-align: center;
            padding: 30px;
            color: white;
            margin-top: 40px;
        }

        footer a {
            color: white;
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2em;
            }

            header p {
                font-size: 1em;
            }

            .slide {
                padding: 40px 20px;
            }

            .slide h2 {
                font-size: 1.8em;
            }

            .slide p {
                font-size: 1em;
            }

            .product-icon {
                font-size: 3em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>D5io</h1>
            <p>Innovative Software Solutions for Modern Businesses</p>
        </header>

        <div class="slideshow-container">
            <button class="prev" onclick="changeSlide(-1)" aria-label="Previous slide">&#10094;</button>
            <button class="next" onclick="changeSlide(1)" aria-label="Next slide">&#10095;</button>

            <div id="slides-wrapper">
                <!-- Slides will be dynamically loaded here -->
            </div>

            <div class="dots-container" id="dots-container">
                <!-- Dots will be dynamically loaded here -->
            </div>
        </div>

        <footer>
            <p>&copy; 2025 D5io. All rights reserved.</p>
            <p><a href="https://github.com/D5-Interactive/D5io" target="_blank">Visit us on GitHub</a></p>
        </footer>
    </div>

    <!-- Include marked.js for markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        let currentSlide = 0;
        let slideInterval;
        let productsLoaded = false;

        // Simple markdown parser fallback when marked.js is not available
        function simpleMarkdownToHtml(markdown) {
            // This is a minimal fallback for basic markdown
            return markdown
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.+?)\*/g, '<em>$1</em>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, ' ');
        }

        // Parse markdown using marked.js or fallback
        function parseMarkdown(markdown) {
            if (typeof marked !== 'undefined' && marked.parse) {
                return marked.parse(markdown);
            } else {
                console.warn('marked.js not available, using simple fallback parser');
                return '<p>' + simpleMarkdownToHtml(markdown) + '</p>';
            }
        }

        // Parse simple frontmatter from markdown content
        function parseFrontmatter(content) {
            const lines = content.split('\n');
            if (lines[0].trim() !== '---') {
                return { meta: null, body: content };
            }

            let i = 1;
            const metaLines = [];
            while (i < lines.length && lines[i].trim() !== '---') {
                metaLines.push(lines[i]);
                i++;
            }

            if (i >= lines.length) {
                return { meta: null, body: content };
            }

            // Parse metadata
            const meta = {};
            for (const line of metaLines) {
                const colonIndex = line.indexOf(':');
                if (colonIndex === -1) continue;
                
                const key = line.substring(0, colonIndex).trim();
                let value = line.substring(colonIndex + 1).trim();
                
                // Parse JSON arrays for tags
                if (value.startsWith('[') && value.endsWith(']')) {
                    try {
                        value = JSON.parse(value);
                    } catch (e) {
                        console.warn('Failed to parse array value:', value);
                    }
                }
                
                meta[key] = value;
            }

            const body = lines.slice(i + 1).join('\n').trim();
            return { meta, body };
        }

        // Generate title from filename
        function generateTitle(filename) {
            return filename
                .replace('.md', '')
                .split('-')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
        }

        // Create a slide element
        function createSlide(product, index) {
            const slide = document.createElement('div');
            slide.className = 'slide';
            if (index === 0) {
                slide.classList.add('active');
            }

            if (product.meta) {
                // Has frontmatter
                const icon = product.meta.icon || 'üì¶';
                const title = product.meta.title || generateTitle(product.filename);
                const tags = Array.isArray(product.meta.tags) ? product.meta.tags : [];

                slide.innerHTML = `
                    <div class="product-icon">${icon}</div>
                    <h2>${title}</h2>
                    <div class="slide-content">${parseMarkdown(product.body)}</div>
                    ${tags.length > 0 ? `
                        <div class="features">
                            ${tags.map(tag => `<span class="feature-tag">${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                `;
            } else {
                // No frontmatter, use markdown body and generate title
                const title = generateTitle(product.filename);
                slide.innerHTML = `
                    <h2>${title}</h2>
                    <div class="slide-content">${parseMarkdown(product.body)}</div>
                `;
            }

            return slide;
        }

        // Create a dot element
        function createDot(index) {
            const dot = document.createElement('button');
            dot.className = 'dot';
            if (index === 0) {
                dot.classList.add('active');
                dot.setAttribute('aria-current', 'true');
            }
            dot.setAttribute('aria-label', `Go to slide ${index + 1}`);
            dot.onclick = () => setSlide(index);
            return dot;
        }

        // Load products from manifest and markdown files
        async function loadProducts() {
            try {
                // Fetch the manifest
                const manifestResponse = await fetch('products/products.json', { cache: 'no-cache' });
                if (!manifestResponse.ok) {
                    throw new Error(`Failed to load products.json: ${manifestResponse.status}`);
                }
                
                const productFiles = await manifestResponse.json();
                if (!Array.isArray(productFiles) || productFiles.length === 0) {
                    throw new Error('products.json is empty or not an array');
                }

                const products = [];
                
                // Fetch each product markdown file
                for (const filename of productFiles) {
                    try {
                        const response = await fetch(`products/${filename}`, { cache: 'no-cache' });
                        if (!response.ok) {
                            console.warn(`Failed to load ${filename}: ${response.status}`);
                            continue;
                        }
                        
                        const content = await response.text();
                        const { meta, body } = parseFrontmatter(content);
                        products.push({ filename, meta, body });
                    } catch (error) {
                        console.warn(`Error loading ${filename}:`, error);
                    }
                }

                if (products.length === 0) {
                    throw new Error('No products loaded successfully');
                }

                // Build slides and dots
                const slidesWrapper = document.getElementById('slides-wrapper');
                const dotsContainer = document.getElementById('dots-container');
                
                slidesWrapper.innerHTML = '';
                dotsContainer.innerHTML = '';

                products.forEach((product, index) => {
                    slidesWrapper.appendChild(createSlide(product, index));
                    dotsContainer.appendChild(createDot(index));
                });

                productsLoaded = true;
                initializeSlideshow();
            } catch (error) {
                console.error('Error loading products:', error);
                showFallbackSlide();
            }
        }

        // Show fallback slide when loading fails
        function showFallbackSlide() {
            const slidesWrapper = document.getElementById('slides-wrapper');
            const dotsContainer = document.getElementById('dots-container');
            
            slidesWrapper.innerHTML = `
                <div class="slide active">
                    <div class="product-icon">‚ö†Ô∏è</div>
                    <h2>Products Loading</h2>
                    <p>We're having trouble loading our products. Please refresh the page or check back later.</p>
                </div>
            `;
            
            dotsContainer.innerHTML = `
                <button class="dot active" aria-label="Slide 1" aria-current="true"></button>
            `;
        }

        function showSlide() {
            const slides = document.getElementsByClassName('slide');
            const dots = document.getElementsByClassName('dot');

            if (slides.length === 0) return;

            if (currentSlide >= slides.length) {
                currentSlide = 0;
            }
            if (currentSlide < 0) {
                currentSlide = slides.length - 1;
            }

            // Hide all slides and remove aria-current
            for (let i = 0; i < slides.length; i++) {
                slides[i].classList.remove('active');
                if (dots[i]) {
                    dots[i].classList.remove('active');
                    dots[i].removeAttribute('aria-current');
                }
            }

            // Show current slide and set aria-current
            slides[currentSlide].classList.add('active');
            if (dots[currentSlide]) {
                dots[currentSlide].classList.add('active');
                dots[currentSlide].setAttribute('aria-current', 'true');
            }
        }

        function changeSlide(n) {
            currentSlide += n;
            showSlide();
            resetInterval();
        }

        function setSlide(n) {
            currentSlide = n;
            showSlide();
            resetInterval();
        }

        function nextSlide() {
            currentSlide++;
            showSlide();
        }

        function resetInterval() {
            clearInterval(slideInterval);
            slideInterval = setInterval(nextSlide, 5000);
        }

        function pauseSlideshow() {
            clearInterval(slideInterval);
        }

        function resumeSlideshow() {
            slideInterval = setInterval(nextSlide, 5000);
        }

        function initializeSlideshow() {
            showSlide();
            slideInterval = setInterval(nextSlide, 5000); // Change slide every 5 seconds

            // Pause slideshow on hover or focus for accessibility (WCAG compliance)
            const slideshowContainer = document.querySelector('.slideshow-container');
            slideshowContainer.addEventListener('mouseenter', pauseSlideshow);
            slideshowContainer.addEventListener('mouseleave', resumeSlideshow);
            slideshowContainer.addEventListener('focusin', pauseSlideshow);
            slideshowContainer.addEventListener('focusout', resumeSlideshow);
        }

        // Load products when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadProducts);
        } else {
            loadProducts();
        }
    </script>
</body>
</html>
